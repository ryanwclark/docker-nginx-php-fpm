#!/usr/bin/with-contenv bash

### Set Defaults
CONTAINER_MODE=${CONTAINER_MODE:-"nginx-php-fpm"}
ENABLE_PHP_FPM=${ENABLE_PHP_FPM:-"TRUE"}
PHP_APC_SHM_SIZE=${PHP_APC_SHM_SIZE:-"128M"}
if [ "$(php -v | head -n 1 | awk '{print $2}' | cut -c 1)" != "8" ] ; then PHP_ENABLE_JSON=${PHP_ENABLE_JSON:-"TRUE"} ; fi
PHP_DISPLAY_ERRORS=${PHP_DISPLAY_ERRORS:-"TRUE"}
PHP_KITCHENSINK=${PHP_KITCHENSINK:-"FALSE"}
PHP_FPM_HOST=${PHP_FPM_HOST:-"127.0.0.1"}
PHP_FPM_LISTEN_PORT=${PHP_FPM_LISTEN_PORT:-9000}
PHP_FPM_MAX_CHILDREN=${PHP_FPM_MAX_CHILDREN:-75}
PHP_FPM_MAX_REQUESTS=${PHP_FPM_MAX_REQUESTS:-500}
PHP_FPM_MAX_SPARE_SERVERS=${PHP_FPM_MAX_SPARE_SERVERS:-3}
PHP_FPM_MIN_SPARE_SERVERS=${PHP_FPM_MIN_SPARE_SERVERS:-1}
PHP_FPM_PROCESS_MANAGER=${PHP_FPM_PROCESS_MANAGER:-"dynamic"}
PHP_FPM_START_SERVERS=${PHP_FPM_START_SERVERS:-2}
PHP_LOG_FILE=${PHP_LOG_FILE:-"php-fpm.log"}
PHP_LOG_LEVEL=${PHP_LOG_LEVEL:-"notice"}
PHP_LOG_LOCATION=${PHP_LOG_LOCATION:-"/www/logs/php-fpm"}
PHP_MEMORY_LIMIT=${PHP_MEMORY_LIMIT:-"128M"}
PHP_OPCACHE_MEM_SIZE=${PHP_OPCACHE_MEM_SIZE:-"128"}
PHP_POST_MAX_SIZE=${PHP_POST_MAX_SIZE:-"2G"}
PHP_TIMEOUT=${PHP_TIMEOUT:-"180"}
PHP_UPLOAD_MAX_SIZE=${PHP_UPLOAD_MAX_SIZE:-"2G"}
PHP_VERSION=${PHP_VERSION:-$(php -v | head -n 1 | awk '{print $2}')}
PHP_WEBROOT=${PHP_WEBROOT:-$NGINX_WEBROOT}
PHP_XDEBUG_PROFILER_DIR=${PHP_XDEBUG_PROFILER_DIR:-"${PHP_LOG_DIR}/xdebug/"}
PHP_XDEBUG_PROFILER_ENABLE=${PHP_XDEBUG_PROFILER_ENABLE:-"0"}
PHP_XDEBUG_PROFILER_ENABLE_TRIGGER=${PHP_XDEBUG_PROFILER_ENABLE_TRIGGER:-"0"}
PHP_XDEBUG_REMOTE_AUTOSTART=${PHP_XDEBUG_REMOTE_AUTOSTART:-"1"}
PHP_XDEBUG_REMOTE_CONNECT_BACK=${PHP_XDEBUG_REMOTE_CONNECT_BACK:-"0"}
PHP_XDEBUG_REMOTE_ENABLE=${PHP_XDEBUG_REMOTE_ENABLE:-"1"}
PHP_XDEBUG_REMOTE_HANDLER=${PHP_XDEBUG_REMOTE_HANDLER:-"dbgp"}
PHP_XDEBUG_REMOTE_HOST=${PHP_XDEBUG_REMOTE_HOST:-"127.0.0.1"}
PHP_XDEBUG_REMOTE_PORT=${PHP_XDEBUG_REMOTE_PORT:-"9090"}

if var_true "${PHP_ENABLE_REDIS}" || \
   var_true "${PHP_ENABLE_MEMCACHED}" \
   ; then \
    if [ -f "/usr/lib/php$(php -v | head -n 1 | awk '{print $2}' | cut -c 1)/modules/igbinary.so" ] ; then
        PHP_ENABLE_IGBINARY=${PHP_ENABLE_IGBINARY:-"TRUE"}
    fi
fi